---
import BackgroundWrapper from '../components/BackgroundWrapper';
import '../styles/globals.css';

interface Props {
  title?: string;
}

const { title = 'è„¸ä¹¦å°åŠ©æ‰‹' } = Astro.props;
---

<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <meta name="description" content="ä¸“ä¸º Facebook æ³¨å†Œè®¾è®¡çš„èº«ä»½ç”Ÿæˆå·¥å…·ï¼Œæ™ºèƒ½ç”Ÿæˆç¬¦åˆçœŸå®ç”¨æˆ·ç‰¹å¾çš„å§“åã€ç”Ÿæ—¥ã€æ‰‹æœºå·ã€é‚®ç®±ç­‰ä¿¡æ¯ï¼Œæ”¯æŒå…¨çƒ100+å›½å®¶åœ°åŒºï¼Œæé«˜è´¦å·æ³¨å†ŒæˆåŠŸç‡" />
    <meta name="keywords" content="Facebookåˆ›å·,FBæ³¨å†ŒåŠ©æ‰‹,Facebookè´¦å·ç”Ÿæˆå™¨,FBèº«ä»½ç”Ÿæˆ,ç¤¾äº¤åª’ä½“æ³¨å†Œå·¥å…·,Facebookæ³¨å†Œä¿¡æ¯,ä¸´æ—¶é‚®ç®±,æµ‹è¯•è´¦å·" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="FBåˆ›å·å°åŠ©æ‰‹" />
    <meta name="theme-color" content="#1877F2" />
    <meta name="application-name" content="FBåˆ›å·å°åŠ©æ‰‹" />

    <meta property="og:title" content="è„¸ä¹¦å°åŠ©æ‰‹" />
    <meta property="og:description" content="å¿«é€Ÿç”Ÿæˆç¬¦åˆ Facebook ç”¨æˆ·ç‰¹å¾çš„çœŸå®èº«ä»½ä¿¡æ¯ï¼Œæ”¯æŒå…¨çƒåœ°åŒº" />
    <meta property="og:type" content="website" />

    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“±</text></svg>" />
    <title>{title}</title>

    <!-- å…¨å±€èƒŒæ™¯åˆå§‹åŒ–è„šæœ¬ - ç¡®ä¿ä¼šè¯å†…100%ä¸€è‡´ -->
    <script is:inline>
      (function() {
        const BG_CACHE_KEY = 'app_background_cache';
        const BG_SESSION_KEY = 'app_background_session';
        const BG_EXPIRE_TIME = 24 * 60 * 60 * 1000;

        function initGlobalBackground() {
          try {
            // ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šæ£€æŸ¥ sessionStorage
            // å¦‚æœå·²å­˜åœ¨ï¼Œè¯´æ˜æ˜¯åŒä¸€ä¼šè¯å†…çš„é¡µé¢è·³è½¬ï¼Œå¿…é¡»ä½¿ç”¨ç›¸åŒURL
            const sessionUrl = sessionStorage.getItem(BG_SESSION_KEY);
            if (sessionUrl) {
              return;
            }

            // ç¬¬äºŒä¼˜å…ˆçº§ï¼šæ£€æŸ¥ localStorage ç¼“å­˜
            const cached = localStorage.getItem(BG_CACHE_KEY);
            if (cached) {
              try {
                const data = JSON.parse(cached);
                const now = Date.now();
                if (now - data.timestamp <= BG_EXPIRE_TIME) {
                  // å°†ç¼“å­˜çš„URLå†™å…¥sessionï¼Œé”å®šæœ¬æ¬¡ä¼šè¯
                  sessionStorage.setItem(BG_SESSION_KEY, data.url);
                  return;
                }
              } catch (e) {
                localStorage.removeItem(BG_CACHE_KEY);
              }
            }

            // ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šç”Ÿæˆæ–°URLï¼ˆä»…åœ¨æ— ä»»ä½•ç¼“å­˜æ—¶ï¼‰
            // ä½¿ç”¨å½“å‰æ—¶é—´æˆ³ä½œä¸ºå”¯ä¸€æ ‡è¯†
            const timestamp = Date.now();
            const newUrl = `https://loliapi.com/acg/?seed=${timestamp}`;

            // ç«‹å³é”å®šåˆ° sessionStorageï¼Œç¡®ä¿åç»­é¡µé¢ä½¿ç”¨ç›¸åŒURL
            sessionStorage.setItem(BG_SESSION_KEY, newUrl);

            // åŒæ—¶ç¼“å­˜åˆ° localStorage ä¾›ä¸‹æ¬¡ä¼šè¯ä½¿ç”¨
            const cacheData = {
              url: newUrl,
              timestamp: timestamp
            };
            localStorage.setItem(BG_CACHE_KEY, JSON.stringify(cacheData));
          } catch (error) {
            console.error('Background initialization error:', error);
          }
        }

        initGlobalBackground();
      })();
    </script>

    <!-- 51.la ç»Ÿè®¡ä»£ç  -->
    <script is:inline>
      (function() {
        var script = document.createElement('script');
        script.charset = 'UTF-8';
        script.src = 'https://sdk.51.la/js-sdk-pro.min.js';
        script.onerror = function() {
          // Silently fail if analytics script cannot load
        };
        script.onload = function() {
          if (window.LA) {
            LA.init({
              id: "3OCxas9dwRFL8FZ6",
              ck: "3OCxas9dwRFL8FZ6",
              autoTrack: true,
              hashMode: true
            });
          }
        };
        document.head.appendChild(script);
      })();
    </script>
  </head>
  <body class="antialiased">
    <BackgroundWrapper client:only="react">
      <slot />
    </BackgroundWrapper>
  </body>
</html>
